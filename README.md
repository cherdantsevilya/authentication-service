# Сервис Аутентификации

Безопасный сервис аутентификации, написанный на Go, с поддержкой двухфакторной аутентификации (2FA) на основе TOTP.

## Возможности

- Регистрация пользователей с email
- Безопасное хеширование паролей
- Двухфакторная аутентификация (2FA) с использованием TOTP
- Аутентификация на основе JWT токенов
- Защита от брутфорс атак
- Современный веб-интерфейс
- RESTful API

## Требования

- Go 1.19 или выше
- PostgreSQL
- Docker и Docker Compose
- Make (опционально, для использования команд Makefile)

## Пошаговая инструкция по запуску

### 1. Клонирование репозитория

```bash
git clone https://github.com/yourusername/authentication-service.git
cd authentication-service
```

### 2. Запуск базы данных и зависимостей

```bash
# Запуск PostgreSQL и других сервисов через Docker Compose
make docker-up

# Дождитесь полной инициализации контейнеров (обычно 10-15 секунд)
```

### 3. Применение миграций

```bash
# Подключение к контейнеру с базой данных
docker exec -i authentication-service-postgres-1 psql -U postgres -d auth_db < migrations/001_init.sql
```

### 4. Запуск сервиса

```bash
# Сборка и запуск сервиса
make run
```

После успешного запуска сервис будет доступен по адресу: `http://localhost:8080`

## Использование сервиса

### 1. Регистрация нового пользователя
- Откройте `http://localhost:8080` в браузере
- Нажмите "Register"
- Заполните форму регистрации:
  - Username
  - Email
  - Password

### 2. Вход в систему
- Используйте форму входа с вашими учетными данными
- При первом входе система предложит настроить 2FA

### 3. Настройка двухфакторной аутентификации (2FA)
- После входа нажмите кнопку "Setup 2FA"
- Отсканируйте QR-код с помощью приложения Google Authenticator
- Введите код подтверждения из приложения

## Структура проекта

```
.
├── cmd/
│   └── server/          # Точка входа в приложение
├── internal/
│   ├── api/            # HTTP обработчики
│   ├── models/         # Модели данных
│   ├── repository/     # Операции с базой данных
│   └── service/        # Бизнес-логика
├── migrations/         # SQL миграции
├── web/
│   ├── static/         # Статические файлы (JS, CSS)
│   └── templates/      # HTML шаблоны
└── docker-compose.yml  # Конфигурация Docker
```

## Доступные команды Make

- `make docker-up` - Запуск всех сервисов в Docker
- `make docker-down` - Остановка всех сервисов
- `make run` - Локальный запуск приложения
- `make build` - Сборка приложения

## API Endpoints

### Аутентификация

- `POST /api/v1/auth/register` - Регистрация нового пользователя
- `POST /api/v1/auth/login` - Вход по логину и паролю
- `POST /api/v1/auth/verify-totp` - Проверка TOTP кода для 2FA

### Защищенные маршруты

- `POST /api/v1/protected/setup-2fa` - Настройка 2FA для текущего пользователя
- `GET /api/v1/protected/me` - Получение информации о текущем пользователе
- `POST /api/v1/admin/disable-2fa/:username` - Отключение 2FA для пользователя (только для админов)

## Безопасность

- Хеширование паролей с использованием bcrypt
- Двухфакторная аутентификация на основе TOTP
- Блокировка аккаунта после нескольких неудачных попыток
- Безопасное управление сессиями с использованием JWT
- Поддержка HTTPS (при настройке)
